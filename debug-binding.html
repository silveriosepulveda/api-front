<!DOCTYPE html>
<html ng-app="testApp">
<head>
    <meta charset="UTF-8">
    <title>Debug PopUpModal Binding</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body ng-controller="TestCtrl">
    <div class="container">
        <h2>üî¨ Debug PopUpModal Binding</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>üìä Dados de Entrada</h4>
                <p><strong>Rota:</strong> {{dadosModal.rota}}</p>
                <p><strong>Classe:</strong> {{dadosModal.classe}}</p>
                <p><strong>Par√¢metros:</strong> {{dadosModal.parametros | json}}</p>
                
                <button class="btn btn-primary" ng-click="mostrarModal = true">
                    Mostrar Modal
                </button>
                
                <button class="btn btn-secondary ml-2" ng-click="mostrarModal = false">
                    Ocultar Modal
                </button>
            </div>
            
            <div class="col-md-6">
                <h4>üéõÔ∏è Controles</h4>
                <div class="form-group">
                    <label>Rota:</label>
                    <input type="text" class="form-control" ng-model="dadosModal.rota">
                </div>
                <div class="form-group">
                    <label>Classe:</label>
                    <input type="text" class="form-control" ng-model="dadosModal.classe">
                </div>
            </div>
        </div>
        
        <hr>
        
        <!-- Modal Container -->
        <div ng-show="mostrarModal">
            <pop-up-modal 
                modal-id="debug-modal"
                titulo="Modal de Debug"
                rota="{{dadosModal.rota}}"
                classe-estrutura="{{dadosModal.classe}}"
                parametros="dadosModal.parametros">
            </pop-up-modal>
        </div>
    </div>

    <script>
        angular.module('testApp', [])
        .controller('TestCtrl', function($scope, $timeout) {
            $scope.mostrarModal = false;
            
            $scope.dadosModal = {
                rota: '/sistema-usuario/usuario',
                classe: 'usuario',
                parametros: {id: 456, teste: 'debug'}
            };
            
            // Watch para detectar mudan√ßas no modal
            $scope.$watch('mostrarModal', function(newVal) {
                console.log('üëÅÔ∏è [TestCtrl] mostrarModal mudou para:', newVal);
                
                if (newVal) {
                    $timeout(function() {
                        $('#debug-modal').modal('show');
                    }, 300);
                }
            });
        })
        
        // Mock da estruturaGerencia mais detalhado
        .directive('estruturaGerencia', function() {
            return {
                restrict: 'E',
                template: `
                    <div style="border: 3px solid #28a745; background: #f8fff8; padding: 20px; margin: 15px 0;">
                        <h3>üèóÔ∏è EstrutraGerencia (Mock Detalhado)</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5>üìù Atributos Recebidos:</h5>
                                <table class="table table-sm">
                                    <tr><td>classe</td><td>{{classe || 'VAZIO'}}</td></tr>
                                    <tr><td>localExibicao</td><td>{{localExibicao || 'VAZIO'}}</td></tr>
                                    <tr><td>subacao</td><td>{{subacao || 'VAZIO'}}</td></tr>
                                    <tr><td>parametros</td><td>{{parametros || 'VAZIO'}}</td></tr>
                                </table>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>üîß Atributos Brutos ($attrs):</h5>
                                <pre style="font-size: 11px; background: #f0f0f0; padding: 10px;">{{attrsRaw | json}}</pre>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <strong>Status:</strong> 
                            <span ng-if="classe">‚úÖ Classe definida</span>
                            <span ng-if="!classe">‚ùå Classe n√£o definida</span>
                            
                            <span ng-if="localExibicao === 'modal'">‚úÖ Modo Modal</span>
                            <span ng-if="localExibicao !== 'modal'">‚ö†Ô∏è N√£o √© modo modal</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Campo de Teste:</label>
                            <input type="text" class="form-control" placeholder="Se voc√™ v√™ isto, a estrutura est√° funcionando">
                        </div>
                    </div>
                `,
                scope: {
                    classe: '@',
                    localExibicao: '@',
                    subacao: '@',
                    parametros: '@'
                },
                controller: function($scope, $attrs) {
                    console.log('üèóÔ∏è [estruturaGerencia-Mock] Controller inicializado');
                    console.log('   üì¶ Scope:', $scope);
                    console.log('   üì¶ Attrs:', $attrs);
                    
                    // Expor attrs no scope para visualiza√ß√£o
                    $scope.attrsRaw = {};
                    angular.forEach($attrs, function(value, key) {
                        if (key.indexOf('$') !== 0) { // Filtrar propriedades internas do Angular
                            $scope.attrsRaw[key] = value;
                        }
                    });
                    
                    // Log detalhado dos valores
                    console.log('   üéØ Valores finais:');
                    console.log('      - classe:', $scope.classe);
                    console.log('      - localExibicao:', $scope.localExibicao);  
                    console.log('      - subacao:', $scope.subacao);
                    console.log('      - parametros:', $scope.parametros);
                }
            };
        });
    </script>
    
    <!-- Incluir PopUpModal -->
    <script src="js/directives/srcDirectivesPadrao/PopUpModal.js"></script>
</body>
</html>
