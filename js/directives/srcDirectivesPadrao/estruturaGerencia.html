<!-- 
    Estrutura Gerencia - Template HTML
    Template responsivo com integração de sub-diretivas
-->
<div class="estrutura-gerencia-container">
    
    <!-- ===== CABEÇALHO DE CONSULTA ===== -->
    <div ng-if="isTelaConsulta() && exibirCabecalho" class="cabecalho-consulta-section">
        <div cabecalho-consulta
             campos="camposFiltroMesclados"
             filtro="filtro"
             funcao-pesquisar="pesquisar"
             funcao-limpar="limparFiltros"
             funcao-novo="novoRegistro"
             exibir-botao-novo="exibirBotaoNovo">
        </div>
    </div>
    
    <!-- ===== LISTA DE CONSULTA ===== -->
    <div ng-if="isTelaConsulta()" class="lista-consulta-section">
        
        <!-- Lista de dados com paginação -->
        <div class="lista-dados">
            <div ng-if="listaConsulta.length == 0" class="alert alert-info text-center">
                <i class="fa fa-info-circle"></i> Nenhum item encontrado
            </div>
            
            <div ng-if="listaConsulta.length > 0" class="resultados-lista">
                
                <!-- Informações de paginação -->
                <div ng-if="exibirPaginacao" class="paginacao-info row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="itensPagina">Itens por página:</label>
                            <select id="itensPagina" 
                                    class="form-control" 
                                    style="width: auto; display: inline-block; margin-left: 10px;"
                                    ng-model="itensPagina" 
                                    ng-change="alterarItensPagina(itensPagina)">
                                <option ng-repeat="opcao in itensPorPaginaOpcoes" 
                                        value="{{ opcao }}"
                                        ng-selected="opcao == itensPagina">{{ opcao }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6 text-right">
                        <div class="info-registros">
                            {{ calcularInfoPaginacao().inicio }} - {{ calcularInfoPaginacao().fim }} 
                            de {{ calcularInfoPaginacao().total }} registros
                        </div>
                    </div>
                </div>
                
                <!-- Lista de itens -->
                <div class="row" ng-repeat="item in listaConsulta | limitTo:itensPagina:(paginaAtual-1)*itensPagina">
                    <div class="col-md-12 item-consulta">
                        
                        <!-- Campos do item -->
                        <div ng-repeat="(campo, valor) in item" ng-if="campo !== '$$hashKey'">
                            <strong>{{ campo }}:</strong> {{ valor }}
                        </div>
                        
                        <!-- Ações com controle de permissões -->
                        <div class="acoes-item" ng-if="acoes && acoes.length > 0">
                            <div class="btn-group">
                                <button ng-repeat="acao in acoes"
                                        ng-if="!acao.visivel || acao.visivel()"
                                        ng-click="acao.funcao(item)"
                                        class="{{ acao.classe }}"
                                        title="{{ acao.tooltip }}">
                                    <i class="{{ acao.icone }}"></i>
                                </button>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
                <!-- Controles de paginação -->
                <div ng-if="exibirPaginacao && totalPaginas > 1" class="paginacao-controles">
                    <nav aria-label="Navegação de páginas">
                        <ul class="pagination justify-content-center">
                            
                            <!-- Primeira página -->
                            <li class="page-item" ng-class="{ disabled: paginaAtual <= 1 }">
                                <a class="page-link" 
                                   ng-click="primeiraPagina()" 
                                   ng-disabled="paginaAtual <= 1">
                                    {{ paginacaoRotulos.primeiro }}
                                </a>
                            </li>
                            
                            <!-- Página anterior -->
                            <li class="page-item" ng-class="{ disabled: paginaAtual <= 1 }">
                                <a class="page-link" 
                                   ng-click="paginaAnterior()" 
                                   ng-disabled="paginaAtual <= 1">
                                    {{ paginacaoRotulos.anterior }}
                                </a>
                            </li>
                            
                            <!-- Páginas numeradas -->
                            <li ng-repeat="numeroPagina in gerarPaginas()" 
                                class="page-item" 
                                ng-class="{ active: numeroPagina == paginaAtual }">
                                <a class="page-link" ng-click="irParaPagina(numeroPagina)">
                                    {{ numeroPagina }}
                                </a>
                            </li>
                            
                            <!-- Próxima página -->
                            <li class="page-item" ng-class="{ disabled: paginaAtual >= totalPaginas }">
                                <a class="page-link" 
                                   ng-click="proximaPagina()" 
                                   ng-disabled="paginaAtual >= totalPaginas">
                                    {{ paginacaoRotulos.proximo }}
                                </a>
                            </li>
                            
                            <!-- Última página -->
                            <li class="page-item" ng-class="{ disabled: paginaAtual >= totalPaginas }">
                                <a class="page-link" 
                                   ng-click="ultimaPagina()" 
                                   ng-disabled="paginaAtual >= totalPaginas">
                                    {{ paginacaoRotulos.ultimo }}
                                </a>
                            </li>
                            
                        </ul>
                    </nav>
                </div>
                
            </div>
        </div>
        
    </div>
    
    <!-- ===== FORMULÁRIO DE CADASTRO ===== -->
    <div ng-if="isTelaCadastro() && exibirFormulario" class="formulario-cadastro-section">
        
        <!-- Cabeçalho do Formulário -->
        <div class="form-header">
            <div class="row">
                <div class="col-md-8">
                    <h3 class="form-title">
                        {{ modelo.id ? 'Editar Registro' : 'Novo Registro' }}
                    </h3>
                </div>
                <div class="col-md-4 text-right">
                    <div class="btn-group">
                        <button type="button" 
                                class="btn btn-success" 
                                ng-click="salvar()"
                                ng-disabled="formulario.$invalid">
                            <i class="fa fa-save"></i> Salvar
                        </button>
                        <button type="button" 
                                class="btn btn-default" 
                                ng-click="cancelar()">
                            <i class="fa fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Corpo do Formulário -->
        <div class="form-body">
            <form name="formulario" novalidate>
                <div class="row">
                    
                    <!-- Campo Dinâmico -->
                    <div ng-repeat="campo in campos" 
                         class="{{ campo.classesGrid }}"
                         ng-if="!campo.ocultoFormulario">
                        
                        <!-- Label do Campo -->
                        <div class="form-group" ng-class="{ 'has-error': formulario[campo.nome].$invalid && formulario[campo.nome].$touched }">
                            <label class="control-label" for="{{ campo.nome }}">
                                {{ campo.rotulo || campo.nome }}
                                <span ng-if="campo.obrigatorio" class="text-danger">*</span>
                            </label>
                            
                            <!-- INPUT TEXT -->
                            <input ng-if="campo.tipo === 'text' || !campo.tipo"
                                   type="text"
                                   id="{{ campo.nome }}"
                                   name="{{ campo.nome }}"
                                   class="form-control"
                                   ng-model="modelo[campo.nome]"
                                   placeholder="{{ campo.placeholder }}"
                                   ng-required="campo.obrigatorio"
                                   ng-maxlength="campo.tamanhoMaximo"
                                   ng-blur="modelo[campo.nome] = aplicarMascara(campo, modelo[campo.nome])">
                            
                            <!-- INPUT NUMBER -->
                            <input ng-if="campo.tipo === 'number'"
                                   type="number"
                                   id="{{ campo.nome }}"
                                   name="{{ campo.nome }}"
                                   class="form-control"
                                   ng-model="modelo[campo.nome]"
                                   placeholder="{{ campo.placeholder }}"
                                   ng-required="campo.obrigatorio"
                                   min="{{ campo.valorMinimo }}"
                                   max="{{ campo.valorMaximo }}">
                            
                            <!-- INPUT EMAIL -->
                            <input ng-if="campo.tipo === 'email'"
                                   type="email"
                                   id="{{ campo.nome }}"
                                   name="{{ campo.nome }}"
                                   class="form-control"
                                   ng-model="modelo[campo.nome]"
                                   placeholder="{{ campo.placeholder }}"
                                   ng-required="campo.obrigatorio">
                            
                            <!-- INPUT PASSWORD -->
                            <input ng-if="campo.tipo === 'password'"
                                   type="password"
                                   id="{{ campo.nome }}"
                                   name="{{ campo.nome }}"
                                   class="form-control"
                                   ng-model="modelo[campo.nome]"
                                   placeholder="{{ campo.placeholder }}"
                                   ng-required="campo.obrigatorio">
                            
                            <!-- INPUT DATE -->
                            <input ng-if="campo.tipo === 'date'"
                                   type="date"
                                   id="{{ campo.nome }}"
                                   name="{{ campo.nome }}"
                                   class="form-control"
                                   ng-model="modelo[campo.nome]"
                                   ng-required="campo.obrigatorio">
                            
                            <!-- TEXTAREA -->
                            <textarea ng-if="campo.tipo === 'textarea'"
                                     id="{{ campo.nome }}"
                                     name="{{ campo.nome }}"
                                     class="form-control"
                                     ng-model="modelo[campo.nome]"
                                     placeholder="{{ campo.placeholder }}"
                                     ng-required="campo.obrigatorio"
                                     rows="{{ campo.linhas || 3 }}">
                            </textarea>
                            
                            <!-- SELECT -->
                            <select ng-if="campo.tipo === 'select'"
                                    id="{{ campo.nome }}"
                                    name="{{ campo.nome }}"
                                    class="form-control"
                                    ng-model="modelo[campo.nome]"
                                    ng-required="campo.obrigatorio"
                                    ng-options="opcao.valor as opcao.texto for opcao in campo.opcoes">
                                <option value="">{{ campo.placeholder || 'Selecione...' }}</option>
                            </select>
                            
                            <!-- CHECKBOX -->
                            <div ng-if="campo.tipo === 'checkbox'" class="checkbox">
                                <label>
                                    <input type="checkbox"
                                           id="{{ campo.nome }}"
                                           name="{{ campo.nome }}"
                                           ng-model="modelo[campo.nome]">
                                    {{ campo.textoCheckbox || campo.rotulo }}
                                </label>
                            </div>
                            
                            <!-- RADIO -->
                            <div ng-if="campo.tipo === 'radio'" class="radio-group">
                                <div class="radio" ng-repeat="opcao in campo.opcoes">
                                    <label>
                                        <input type="radio"
                                               name="{{ campo.nome }}"
                                               ng-model="modelo[campo.nome]"
                                               value="{{ opcao.valor }}"
                                               ng-required="campo.obrigatorio">
                                        {{ opcao.texto }}
                                    </label>
                                </div>
                            </div>
                            
                            <!-- AUTO COMPLETA -->
                            <div ng-if="campo.tipo === 'autoCompleta' && configurarAutoCompleta(campo)"
                                 auto-completa
                                 ng-model="modelo[campo.nome]"
                                 config="configurarAutoCompleta(campo)">
                            </div>
                            
                            <!-- Mensagens de Validação -->
                            <div ng-if="formulario[campo.nome].$invalid && formulario[campo.nome].$touched" 
                                 class="help-block">
                                <span ng-if="formulario[campo.nome].$error.required">
                                    Este campo é obrigatório
                                </span>
                                <span ng-if="formulario[campo.nome].$error.email">
                                    Email inválido
                                </span>
                                <span ng-if="formulario[campo.nome].$error.maxlength">
                                    Texto muito longo
                                </span>
                                <span ng-if="formulario[campo.nome].$error.min">
                                    Valor mínimo: {{ campo.valorMinimo }}
                                </span>
                                <span ng-if="formulario[campo.nome].$error.max">
                                    Valor máximo: {{ campo.valorMaximo }}
                                </span>
                            </div>
                            
                        </div>
                    </div>
                    
                </div>
            </form>
        </div>
        
        <!-- Rodapé do Formulário -->
        <div class="form-footer">
            <div class="row">
                <div class="col-md-12 text-right">
                    <div class="btn-group">
                        <button type="button" 
                                class="btn btn-success" 
                                ng-click="salvar()"
                                ng-disabled="formulario.$invalid">
                            <i class="fa fa-save"></i> Salvar
                        </button>
                        <button type="button" 
                                class="btn btn-default" 
                                ng-click="cancelar()">
                            <i class="fa fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- ===== LOADING ===== -->
    <div ng-if="carregando" class="loading-overlay">
        <div class="loading-content">
            <i class="fa fa-spinner fa-spin fa-2x"></i>
            <p>Carregando...</p>
        </div>
    </div>
    
</div>